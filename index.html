<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../photo_2025-09-22_20-52-48-removebg-preview.png">
    <title>Invoice</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <!-- Admin Header -->
    <div class="admin-header">
        <div class="header-left">
            <button class="mobile-menu-toggle" onclick="toggleSidebar()" id="mobileMenuToggle" title="Hide Sidebar">
                ‚ò∞
            </button>
            <div class="admin-info">
                <span class="admin-welcome">Welcome, <span id="adminUsername">Admin</span> <span class="header-timer" id="headerTimer"></span></span>
                <span class="login-time" id="loginTime"></span>
            </div>
        </div>
        <button class="logout-btn" onclick="handleLogout()">
            üö™ Logout
        </button>
    </div>

        <!-- Product Actions Modal (Tailwind UI) -->
        <div class="app-wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Invoice Tools</h2>
            </div>
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <h3>Quick Actions</h3>
                    <button class="sidebar-btn" onclick="printInvoice()">üìÑ Print Invoice</button>
                    <button class="sidebar-btn" onclick="clearInvoice()">üóëÔ∏è Clear All</button>
                </div>
                <div class="sidebar-section">
                    <h3>Products</h3>
                    <button class="sidebar-btn" onclick="toggleProductCatalog()">üóÇÔ∏è Product Catalog</button>
                </div>
                <div class="sidebar-section">
                    <h3>Invoice Info</h3>
                    <div class="sidebar-info">
                        <div class="monthly-stats" id="monthlyStats">
                            <a href="dashboard.html" target="_blank" style="text-decoration: none;">
                                <button class="info-label" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 1rem; border-radius: 6px; font-weight: 600; cursor: pointer; width: 100%; text-align: center; transition: transform 0.2s, box-shadow 0.2s;">
                                    <div style="font-size: 1.1rem; margin-bottom: 0.25rem;">üìä Open Dashboard</div>
                                    <div style="font-size: 0.85rem; font-weight: 500; opacity: 0.9;">View real-time sales metrics</div>
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="sidebar-section">
                    <h3>Saved Invoices</h3>
                    <button class="sidebar-btn" onclick="saveCurrentInvoice()">üíæ Save Invoice</button>
                    <div class="invoice-search-container">
                        <input type="date" id="invoiceDateSearch" class="invoice-date-search" 
                               placeholder="Filter by date..." 
                               onchange="filterInvoicesByDate()" 
                               title="Filter invoices by date">
                        <button class="clear-filter-btn" onclick="clearDateFilter()" title="Clear filter">‚úñ</button>
                    </div>
                    <div class="search-results-info" id="invoiceSearchInfo">
                        <a href="all_invoice.html" target="_blank" style="text-decoration: none; display: block;">
                            <button class="sidebar-btn" style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #667eea, #764ba2); margin-bottom: 0.5rem;">
                                üìã <span id="invoiceResultCount">All invoices</span>
                            </button>
                        </a>
                    </div>
                    <div class="invoice-history" id="invoiceHistory">
                        <!-- Saved invoices will appear here -->
                    </div>
                </div>
                <div class="sidebar-section">
                    <h3>Customer Database</h3>
                    <a href="customer.html" target="_blank" style="text-decoration: none; display: block;">
                        <button class="sidebar-btn" style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #667eea, #764ba2); margin-bottom: 0.5rem;">
                            üë• Manage Customers
                        </button>
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="container">
        <!-- Date Section -->
        <div class="date-section">
            <div class="invoice-date">
                <label>Date:</label>
                <input type="date" id="invoiceDate" title="Invoice Date" placeholder="Select date" onchange="updateDateDisplay()">
                <span id="invoiceDateDisplay" class="date-display"></span>
            </div>
        </div>
        
        <script>
        function updateDateDisplay() {
            const dateInput = document.getElementById('invoiceDate');
            const dateDisplay = document.getElementById('invoiceDateDisplay');
            
            if (dateInput.value) {
                const date = new Date(dateInput.value + 'T00:00:00');
                const now = new Date();
                const dateStr = date.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: '2-digit' });
                const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                
                // For screen: show as "12/10/25, 10:16 PM"
                // For print: CSS will format it with line break
                dateDisplay.textContent = dateStr;
                dateDisplay.setAttribute('data-time', timeStr);
            } else {
                const now = new Date();
                const dateStr = now.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: '2-digit' });
                const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                
                dateDisplay.textContent = dateStr;
                dateDisplay.setAttribute('data-time', timeStr);
            }
        }
        
        // Set today's date and call on page load
        window.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('invoiceDate');
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;
            updateDateDisplay();
        });
        </script>

        <!-- Invoice Header -->

        <div class="invoice-header">
            <h1 class="invoice-title">INVOICE</h1>
            <div class="company-info">
                <div class="company-details" style="display: flex; flex-direction: column; align-items: center;">
                    <!-- Company name is now editable -->
                    <input type="text" id="companyNameInput" class="company-name" value="Day-Vy Cosmetics 241" style="font-size: 3rem; font-weight: bold; border: none; background: transparent; width: auto; text-align: center; color: #222; margin-bottom: 0.25em;" />
                    <p contenteditable="true" style="text-align: center; width: 100%; font-size: 1.5rem; font-weight: 600; color: #333;">Telephone: 012 258 508</p>
                </div>
            </div>
        </div>

        <!-- Product Counter -->
        <div class="product-counter">
            <span class="counter-text">Products in Invoice: <span id="productCount">0</span> / ‚àû</span>
            <span class="capacity-note">(Supports 15+ products with scrolling)</span>
        </div>

        <!-- Product Table -->
        <div class="invoice-table">
            <table id="invoiceTable">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="invoiceItems">
                    <!-- Dynamic rows will be added here -->
                </tbody>
            </table>
        </div>

        <!-- Product Catalog Modal -->
        <div id="catalogOverlay" class="catalog-overlay" style="display:none;">
            <div class="catalog-modal" style="display: flex; flex-direction: column; width: 100vw; height: 100vh; max-width: none; max-height: none; border-radius: 0; margin: 0;">
                <!-- Catalog Sidebar -->
                <div class="catalog-sidebar" style="width: 100%; height: 180px; padding: 1.5rem 2rem; border-radius: 0; overflow-y: auto; display: flex; align-items: center; justify-content: space-between;">
                    <!-- Left Section: Stats and Title -->
                    <div style="display: flex; align-items: center; gap: 2rem;">
                        <div class="catalog-sidebar-header">
                            <h3 style="margin: 0; font-size: 1.4rem; text-shadow: 0 1px 3px rgba(0,0,0,0.3); color: white;">üè∑Ô∏è Product Catalog</h3>
                        </div>
                        
                        <!-- Quick Stats -->
                        <div class="catalog-stats" style="border-radius: 12px; padding: 1rem 1.5rem; text-align: center; min-width: 150px;">
                            <div style="font-size: 0.8rem; margin-bottom: 0.25rem; color: rgba(255,255,255,0.9); font-weight: 500;">üìä Total Products</div>
                            <div id="totalProductCount" style="font-size: 1.8rem; font-weight: 900; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">32</div>
                        </div>
                    </div>
                    
                    <!-- Center Section: Brand Filters -->
                    <div class="brand-filters">
                        <div class="brand-title">üîñ Brands <span id="brandCount" style="font-size:0.95rem; color:#fff; opacity:0.8; margin-left:0.5em;"></span></div>
                        <div id="brandFilterList" class="brand-filter-list">
                            <!-- Brand filter buttons will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Right Section: Quick Actions -->
                    <div class="catalog-actions-flex">
                        <div class="catalog-actions-row">
                            <div class="action-group">
                                <button onclick="openAddCustomProductModal()" class="catalog-action-btn add-custom-product">
                                    ‚ûï System Product
                                </button>
                                <button onclick="showAllCatalogProducts()" class="catalog-action-btn show-all">
                                    üìã Show All
                                </button>
                                <button onclick="clearCatalogSearch()" class="catalog-action-btn reset">
                                    üîÑ Reset
                                </button>
                                <button onclick="toggleProductCatalog()" class="catalog-close-btn">
                                    ‚úï
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Main Catalog Content -->
                <div class="catalog-main-content" style="flex: 1; padding: 2rem; border-radius: 0; overflow-y: auto; position: relative; height: calc(100vh - 180px);">
                                </div>
                    <div class="catalog-search-section" style="margin-top: -5rem; margin-bottom: -1rem; position: relative; z-index: 2;">
                        <div style="position: relative;">
                            <input type="text" id="catalogSearchInput" 
                                placeholder="üîç Search for products, brands, or categories..." 
                                oninput="filterCatalogProducts()" 
                                style="width: 100%; padding: 1rem 1.5rem; font-size: 1.5rem; border-radius: 1px; border: 2px solid #e2e8f0; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <div style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: #94a3b8; pointer-events: none; font-size: 1.4rem;">
                                üîç
                            </div>
                        </div>
                    </div>
                    
                    <div id="productCatalogList" style="overflow-y: scroll; position: relative; z-index: 1; height: calc(100vh - 300px); padding-right: 1rem; scrollbar-width: thin;">
                        <!-- Products organized by brand will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Image Display -->
        <div class="product-image-display hidden" id="productImageDisplay">
            <h3>Selected Product</h3>
            <div class="image-container">
                <img id="productImage" src="" alt="Product Image" />
                <div class="image-info">
                    <h4 id="productImageName"></h4>
                    <p id="productImagePrice"></p>
                </div>
            </div>
        </div>

        <!-- Invoice Summary -->
        <div class="invoice-summary">
            <div class="summary-row">
                <span>Delivery Fee:</span>
                <div class="delivery-fee-container">
                    <div class="delivery-fee-input">
                        <span>$</span>
                        <input type="number" id="deliveryFeeInput" value="0.00" min="0" step="0.01" 
                               oninput="updateDeliveryFee(this.value)"
                               onchange="updateDeliveryFee(this.value)" 
                               title="Edit delivery fee amount"
                               placeholder="0.00"
                               class="delivery-fee-field">
                    </div>
                    <span class="delivery-fee-print" id="deliveryFeePrint">$0.00</span>
                </div>
            </div>
            <div class="summary-row total">
                <span>Total:</span>
                <span class="total-amount-container">
                    <span id="total">$0.00</span>
                    <span id="calcIndicator" class="calc-indicator">‚úì</span>
                </span>
            </div>
        </div>

        <!-- Buyer Information -->
        <div class="buyer-info">
            <h3>Buyer Information</h3>
            <div class="buyer-line customer-select-line" id="customerSelectLine">
                <span class="buyer-label">Select Customer:</span>
                <div class="customer-search-wrapper">
                    <input type="text" 
                           id="customerSearchField" 
                           class="buyer-field-line customer-search-field" 
                           placeholder="üîç Search customers by name, phone, or location..."
                           oninput="searchCustomersInBuyer(this.value)"
                           onfocus="showBuyerCustomerSuggestions()"
                           onblur="hideBuyerCustomerSuggestions()"
                           autocomplete="off"
                           title="Start typing to search customers">
                    <div class="buyer-customer-suggestions" id="buyerCustomerSuggestions">
                        <div class="suggestion-header">Recent Customers</div>
                        <!-- Customer suggestions will appear here -->
                    </div>
                </div>
            </div>
            <div class="buyer-line buyer-name-line">
                <span class="buyer-label">Buyer Name:</span>
                <div class="buyer-name-container">
                    <input type="text" id="buyerName" placeholder="Enter customer name" class="buyer-field-line">
                    <button class="buyer-name-toggle" id="buyerNameToggle" onclick="toggleBuyerNamePrint()" title="Show/Hide buyer name on printed invoice">
                        üëÅÔ∏è Show on Print
                    </button>
                </div>
            </div>
            <div class="buyer-line">
                <span class="buyer-label">Telephone:</span>
                <input type="tel" id="buyerPhone" placeholder="" class="buyer-field-line">
            </div>
            <div class="buyer-line">
                <span class="buyer-label">Location:</span>
                <input type="text" id="buyerLocation" placeholder="" class="buyer-field-line">
            </div>
            <div class="buyer-actions">
                <button class="buyer-clear-btn" onclick="clearAllBuyerInfo()" title="Clear all buyer information">
                    üóëÔ∏è Clear All
                </button>
            </div>
        </div>
        </div> <!-- End main-content -->
    </div> <!-- End app-wrapper -->



    <script src="../script.js"></script>
    <script src="../auth.js"></script>
</body>
</html>